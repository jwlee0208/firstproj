<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="sql.board">
        <insert id="insertBoard" parameterType="board.boardDto" useGeneratedKeys="true" keyProperty="boardId">
            INSERT INTO test.TB_BOARD
				(
				board_category,
				title,
				content,
				author_id,
				author_nm,
				create_date)
			VALUES (
				#{boardCategory},
				#{title },
				#{content },
				#{authorId },
				#{authorNm },
				CURRENT_TIMESTAMP())
        </insert>
        <select id="selectList" parameterType="board.boardDto" resultType="board.boardDto">
            <include refid="searchSql"/>   
			<include refid="searchConditionSql"/>    
        </select>
		<!-- 페이징 위한 리스트 갯수 조회 -->    
		<select id="selectListCount" resultType="Integer" parameterType="searchCondition">        
			SELECT count(*) AS totalCnt         
			FROM test.tb_board         
			<include refid="searchConditionSql"/>    

		</select>      
		
		<!-- 리스트 조회 -->    
		<select id="selectBoardList" resultType="board.boardDto" parameterType="searchCondition">                      
			<include refid="searchSql"/>                      
			<include refid="searchConditionSql"/>                         
			ORDER BY board_id desc                
			LIMIT #{startRow}, #{endRow}     
		</select>		
		
		<!--  게시글 조회 -->
		<select id="selectBoardContent" resultType="board.boardDto" parameterType="board.boardDto">
		    <include refid="searchSql"/>
		    <include refid="searchContentSql"/>
		</select>
		<!-- 이전 글 조회 -->
		<select id="selectPrevBoardContent" resultType="board.boardDto" parameterType="board.boardDto">
		 	 <include refid="searchSql"/>  
				where
				<![CDATA[ 
					board_id > ${boardId}
				]]>
				and board_category = ${boardCategory}	
				order by board_id asc
				limit 1	 	 		    
		</select>
		<!-- 다음 글 조회 -->
		<select id="selectNextBoardContent" resultType="board.boardDto" parameterType="board.boardDto">
		 	 <include refid="searchSql"/>  
				where
				<![CDATA[ 
					board_id < ${boardId}
				]]>	
				and board_category = ${boardCategory}
				order by board_id desc
				limit 1	 	 		    
		</select>
		
		
					
		<sql id="searchSql">
			SELECT 
			    board_id,
			    board_category,
			    title,
			    content,
			    author_id,
			    author_nm,
			    create_date
			FROM test.TB_BOARD
		</sql>
		<sql id="searchConditionSql">
			WHERE 1 = 1	
				<if test="boardCategory > 0">
				and board_category = #{boardCategory}    
				</if>
			     	    
		</sql> 
		<sql id="searchContentSql">
		    WHERE 1 = 1
		    <if test="boardId > 0">
		        and board_id = #{boardId}
		    </if>
		    
		</sql>
    </mapper>